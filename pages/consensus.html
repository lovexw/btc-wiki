<div class="page-content">
    <button class="back-button" onclick="goHome()"><i class="fas fa-arrow-left"></i> 返回首页</button>
    
    <h2>共识机制详解</h2>
    
    <h3>1. 什么是共识？</h3>
    
    <p>在分布式系统中，<strong>共识（Consensus）</strong>是指多个节点对系统状态达成一致意见的过程。</p>
    
    <div class="info-box">
        <h4>为什么需要共识？</h4>
        <p>比特币网络中有数千个独立节点：</p>
        <ul>
            <li>没有中央权威</li>
            <li>节点可能接收到不同顺序的交易</li>
            <li>可能出现冲突的区块</li>
            <li>网络延迟和分区</li>
        </ul>
        <p>共识机制确保所有诚实节点最终对账本状态达成一致。</p>
    </div>
    
    <h3>2. 中本聪共识</h3>
    
    <p>比特币使用的共识机制被称为<strong>中本聪共识</strong>，结合了多个组件：</p>
    
    <ul>
        <li><strong>工作量证明（PoW）</strong>：选择出块者</li>
        <li><strong>最长链规则</strong>：解决分叉</li>
        <li><strong>难度调整</strong>：维持出块时间</li>
        <li><strong>经济激励</strong>：奖励诚实行为</li>
    </ul>
    
    <h3>3. 最长链规则</h3>
    
    <h4>3.1 基本原则</h4>
    <p>节点总是接受<strong>累积工作量最大的链</strong>作为有效链。</p>
    
    <pre><code>场景：网络出现分叉

链A: [100] -> [101A] -> [102A]
链B: [100] -> [101B] -> [102B] -> [103B]

链B更长（3个新区块 vs 2个新区块）
所有节点切换到链B
链A被放弃</code></pre>
    
    <h4>3.2 为什么是"工作量"而非"长度"？</h4>
    
    <p>实际上比特币选择累积工作量最大的链，而非简单的最长链：</p>
    
    <pre><code>链的工作量 = Σ(每个区块的难度)

大多数时候，最长链 = 工作量最大的链
但在难度调整期间可能有细微差异</code></pre>
    
    <h3>4. 分叉类型</h3>
    
    <h4>4.1 临时分叉（自然分叉）</h4>
    <p>两个矿工几乎同时找到区块，网络暂时分裂：</p>
    
    <pre><code>时刻T: 
    [... 99] -> [100A]
    [... 99] -> [100B]

网络一部分看到100A，一部分看到100B

时刻T+10分钟:
矿工在100A基础上挖出101
    [... 99] -> [100A] -> [101]

所有节点切换到更长的链
100B被放弃（成为孤块）</code></pre>
    
    <p><strong>频率</strong>：每天发生几次</p>
    <p><strong>影响</strong>：轻微，1-2个区块深度很快解决</p>
    
    <h4>4.2 硬分叉（Hard Fork）</h4>
    <p>协议规则的不兼容升级：</p>
    
    <ul>
        <li>旧节点无法验证新规则的区块</li>
        <li>网络永久分裂成两条链</li>
        <li>需要所有节点升级</li>
    </ul>
    
    <div class="example-box">
        <h4>历史案例</h4>
        <p><strong>Bitcoin Cash (2017)</strong></p>
        <ul>
            <li>将区块大小从1MB增加到8MB</li>
            <li>旧节点拒绝大区块</li>
            <li>形成两个独立币种：BTC和BCH</li>
        </ul>
    </div>
    
    <h4>4.3 软分叉（Soft Fork）</h4>
    <p>向后兼容的协议升级：</p>
    
    <ul>
        <li>新规则是旧规则的子集（更严格）</li>
        <li>旧节点可以验证新区块（虽然不完全理解）</li>
        <li>只需大部分算力升级</li>
    </ul>
    
    <div class="example-box">
        <h4>历史案例</h4>
        <p><strong>SegWit (2017)</strong></p>
        <ul>
            <li>通过软分叉激活</li>
            <li>旧节点看SegWit交易为"anyone can spend"</li>
            <li>但因大部分算力升级，旧节点跟随</li>
        </ul>
    </div>
    
    <h3>5. 51%攻击与防御</h3>
    
    <h4>5.1 攻击能力</h4>
    <p>控制超过50%算力的实体可以：</p>
    
    <ul>
        <li><strong>双重支付</strong>：撤销自己的交易</li>
        <li><strong>审查交易</strong>：拒绝打包特定交易</li>
        <li><strong>自私挖矿</strong>：垄断区块奖励</li>
    </ul>
    
    <h4>5.2 攻击限制</h4>
    <p>即使51%攻击也<strong>无法</strong>：</p>
    
    <ul>
        <li>偷取别人的比特币（需要私钥）</li>
        <li>改变共识规则（节点会拒绝）</li>
        <li>凭空创造比特币</li>
        <li>撤销很久以前的交易（成本太高）</li>
    </ul>
    
    <h4>5.3 经济防御</h4>
    
    <pre><code>攻击成本分析：

算力成本：数十亿美元
电力成本：每天数百万美元
时间成本：需要数月准备

攻击后果：
- 比特币价格暴跌
- 攻击者的投资贬值
- 无法获利

结论：理性攻击者不会发动51%攻击</code></pre>
    
    <h3>6. 最终性</h3>
    
    <h4>6.1 概率最终性</h4>
    <p>比特币没有绝对最终性，只有概率最终性：</p>
    
    <pre><code>确认数    被逆转的概率
1         ~10%
2         ~1%
3         ~0.1%
6         ~0.001%（行业标准）
10        ~0.00001%
100       几乎为0（Coinbase成熟度要求）</code></pre>
    
    <h4>6.2 检查点</h4>
    <p>Bitcoin Core在代码中硬编码某些区块哈希，防止深度重组。</p>
    
    <h3>7. 共识规则</h3>
    
    <h4>7.1 核心规则</h4>
    <ul>
        <li>区块大小限制</li>
        <li>区块奖励金额和减半</li>
        <li>难度计算公式</li>
        <li>交易验证规则</li>
        <li>脚本操作码</li>
    </ul>
    
    <h4>7.2 规则升级</h4>
    <p>通过BIP（Bitcoin Improvement Proposal）提案流程：</p>
    
    <ol>
        <li>提出改进建议</li>
        <li>社区讨论</li>
        <li>实现代码</li>
        <li>激活机制（软分叉/硬分叉）</li>
        <li>部署和监控</li>
    </ol>
    
    <h3>8. 总结</h3>
    
    <div class="success-box">
        <h4>核心要点</h4>
        <ul>
            <li><strong>PoW + 最长链</strong>：中本聪共识的核心</li>
            <li><strong>概率最终性</strong>：确认数越多越安全</li>
            <li><strong>分叉解决</strong>：自动选择最长链</li>
            <li><strong>经济安全</strong>：攻击成本极高</li>
            <li><strong>去中心化升级</strong>：通过BIP流程改进</li>
        </ul>
    </div>
    
    <button class="back-button" onclick="goHome()"><i class="fas fa-arrow-left"></i> 返回首页</button>
</div>
