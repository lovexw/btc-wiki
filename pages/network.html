<div class="page-content">
    <button class="back-button" onclick="goHome()"><i class="fas fa-arrow-left"></i> 返回首页</button>
    
    <h2>P2P网络协议</h2>
    
    <h3>1. 比特币P2P网络概述</h3>
    
    <p>比特币是一个<strong>点对点（Peer-to-Peer）</strong>网络，没有中央服务器。每个节点既是客户端，也是服务器。</p>
    
    <div class="info-box">
        <h4>P2P vs 客户端-服务器</h4>
        <p><strong>传统模式（客户端-服务器）</strong>：</p>
        <ul>
            <li>中心服务器处理所有请求</li>
            <li>客户端依赖服务器</li>
            <li>存在单点故障</li>
        </ul>
        <p><strong>P2P模式（比特币）</strong>：</p>
        <ul>
            <li>所有节点地位平等</li>
            <li>节点互相连接、交换数据</li>
            <li>无单点故障，高度去中心化</li>
        </ul>
    </div>
    
    <h3>2. 节点类型</h3>
    
    <h4>2.1 全节点（Full Node）</h4>
    <ul>
        <li>存储完整区块链</li>
        <li>独立验证所有交易和区块</li>
        <li>为其他节点提供服务</li>
        <li>不依赖任何人</li>
    </ul>
    
    <h4>2.2 轻节点（SPV Node）</h4>
    <ul>
        <li>只下载区块头</li>
        <li>需要查询全节点获取交易</li>
        <li>适合移动设备</li>
    </ul>
    
    <h4>2.3 矿工节点</h4>
    <ul>
        <li>通常也是全节点</li>
        <li>额外进行挖矿工作</li>
    </ul>
    
    <h3>3. 节点发现</h3>
    
    <h4>3.1 DNS种子</h4>
    <p>新节点启动时，通过DNS查询获取初始节点列表：</p>
    <pre><code>seed.bitcoin.sipa.be
dnsseed.bluematt.me
seed.bitcoinstats.com</code></pre>
    
    <h4>3.2 硬编码种子节点</h4>
    <p>Bitcoin Core包含备用IP地址列表，DNS失败时使用。</p>
    
    <h4>3.3 节点地址交换</h4>
    <p>连接后，节点互相交换已知节点列表（ADDR消息）。</p>
    
    <h3>4. 消息类型</h3>
    
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>消息类型</th>
                    <th>功能</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>version</td>
                    <td>握手，交换版本信息</td>
                </tr>
                <tr>
                    <td>verack</td>
                    <td>确认version消息</td>
                </tr>
                <tr>
                    <td>addr</td>
                    <td>传播已知节点地址</td>
                </tr>
                <tr>
                    <td>inv</td>
                    <td>通知有新交易或区块</td>
                </tr>
                <tr>
                    <td>getdata</td>
                    <td>请求交易或区块数据</td>
                </tr>
                <tr>
                    <td>tx</td>
                    <td>传输交易</td>
                </tr>
                <tr>
                    <td>block</td>
                    <td>传输区块</td>
                </tr>
                <tr>
                    <td>getblocks</td>
                    <td>请求区块哈希列表</td>
                </tr>
                <tr>
                    <td>getheaders</td>
                    <td>请求区块头</td>
                </tr>
                <tr>
                    <td>ping/pong</td>
                    <td>保持连接活跃</td>
                </tr>
            </tbody>
        </table>
    </div>
    
    <h3>5. 交易传播</h3>
    
    <pre><code>1. 用户创建交易，广播到节点A
2. 节点A验证交易
3. 节点A发送INV消息给所有邻居："我有新交易abc123"
4. 邻居B发送GETDATA请求完整交易
5. 节点A发送TX消息（完整交易数据）
6. 节点B验证，加入内存池，继续传播
7. 几秒内传遍全网</code></pre>
    
    <h3>6. 区块传播</h3>
    
    <h4>6.1 标准传播</h4>
    <p>类似交易传播，但区块更大，传播慢。</p>
    
    <h4>6.2 Compact Block（BIP152）</h4>
    <p>只传输交易ID，节点从内存池重建完整区块，大幅加速。</p>
    
    <h3>7. 网络安全</h3>
    
    <h4>7.1 Eclipse攻击</h4>
    <p>攻击者控制受害者的所有网络连接，隔离受害者。</p>
    <p><strong>防御</strong>：多样化连接，随机选择节点。</p>
    
    <h4>7.2 女巫攻击</h4>
    <p>攻击者创建大量假节点，试图控制网络。</p>
    <p><strong>防御</strong>：工作量证明使创建区块成本高昂。</p>
    
    <h3>8. 总结</h3>
    
    <p>P2P网络是比特币去中心化的基础，通过冗余和加密确保安全性和韧性。</p>
    
    <button class="back-button" onclick="goHome()"><i class="fas fa-arrow-left"></i> 返回首页</button>
</div>
